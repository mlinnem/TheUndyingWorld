2024-12-27 14:52:27,872 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:52:27,873 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:52:27,874 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:52:27,874 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:52:27,874 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:52:27,874 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:52:27,874 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:52:27,874 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:52:27,874 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:52:27,874 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:52:27,874 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:52:27,874 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:52:27,874 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:52:27,875 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:52:27,875 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:27] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:52:50,190 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:50] "GET / HTTP/1.1" 200 -
2024-12-27 14:52:50,215 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:50] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:52:50,216 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:50] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:52:50,216 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:50] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:52:50,226 - conversation_utils - INFO - Listing conversations
2024-12-27 14:52:50,226 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:52:50,227 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:52:50,227 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:50] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:52:51,253 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:52:51,254 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:52:51,255 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:52:51,255 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:52:51,256 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:52:51,256 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:52:51,256 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:52:51,256 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:52:51,256 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:52:51,256 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:52:51,256 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:52:51,256 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:52:51,256 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:52:51,257 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:52:51,257 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:52:51] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:53:32,344 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:53:32] "GET / HTTP/1.1" 200 -
2024-12-27 14:53:32,364 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:53:32] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:53:32,367 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:53:32] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:53:32,367 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:53:32] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:53:32,379 - conversation_utils - INFO - Listing conversations
2024-12-27 14:53:32,379 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:53:32,380 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:53:32,380 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:53:32] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:53:36,637 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:53:36,638 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:53:36,638 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:53:36,638 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,638 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,638 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,638 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:53:36,639 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,640 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,641 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,641 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:53:36,641 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:53:36,641 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:53:36,641 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:53:36,641 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:53:36,641 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:53:36,642 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:53:36,642 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:53:36,642 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:53:36,642 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:53:36,642 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:53:36,642 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:53:36,642 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:53:36,643 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:53:36,645 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:53:36,646 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:53:36] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:54:13,244 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:54:13] "GET / HTTP/1.1" 200 -
2024-12-27 14:54:13,268 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:54:13] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:54:13,272 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:54:13] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:54:13,272 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:54:13] "GET /static/js/client.js HTTP/1.1" 200 -
2024-12-27 14:54:13,287 - conversation_utils - INFO - Listing conversations
2024-12-27 14:54:13,288 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:54:13,288 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:54:13,289 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:54:13] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:54:14,864 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:54:14,864 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:54:14,864 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:54:14,865 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:54:14,866 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:54:14,866 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:54:14,867 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:54:14,867 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:54:14,867 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:54:14,867 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:54:14,867 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:54:14,867 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:54:14,867 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:54:14,867 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:54:14,867 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:54:14,868 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:54:14,868 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:54:14] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:55:52,122 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:55:52] "GET / HTTP/1.1" 200 -
2024-12-27 14:55:52,148 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:55:52] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:55:52,148 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:55:52] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:55:52,148 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:55:52] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:55:52,160 - conversation_utils - INFO - Listing conversations
2024-12-27 14:55:52,160 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:55:52,160 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:55:52,161 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:55:52] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:55:54,322 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:55:54,323 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:55:54,323 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:55:54,323 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,323 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,323 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,323 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:55:54,324 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:55:54,325 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:55:54,325 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:55:54,325 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:55:54,325 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:55:54,325 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:55:54,325 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:55:54,326 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:55:54,327 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:55:54,327 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:55:54,327 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:55:54,327 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:55:54,328 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:55:54,328 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:55:54,328 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:55:54,328 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:55:54,329 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:55:54,329 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:55:54,330 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:55:54,331 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:55:54] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:56:16,904 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:56:16] "GET / HTTP/1.1" 200 -
2024-12-27 14:56:16,930 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:56:16] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:56:16,931 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:56:16] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:56:16,932 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:56:16] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:56:16,942 - conversation_utils - INFO - Listing conversations
2024-12-27 14:56:16,942 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:56:16,943 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:56:16,943 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:56:16] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:56:18,046 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:56:18,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:56:18,047 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:56:18,047 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:56:18,047 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:56:18,047 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:56:18,048 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:56:18,048 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:56:18,048 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:56:18,048 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:56:18,048 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:56:18,048 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:56:18,049 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:56:18] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:57:01,879 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:01] "GET / HTTP/1.1" 200 -
2024-12-27 14:57:01,900 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:01] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:57:01,901 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:01] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:57:01,901 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:01] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:57:01,912 - conversation_utils - INFO - Listing conversations
2024-12-27 14:57:01,912 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:57:01,912 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:57:01,913 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:01] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:57:04,478 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:57:04,478 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:57:04,479 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:57:04,480 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,481 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:04,482 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:57:04,482 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:57:04,482 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:57:04,482 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:57:04,482 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:57:04,482 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:57:04,482 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:04,483 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:04,483 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:57:04,483 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:57:04,483 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:04,484 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:57:04,484 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:57:04,486 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:57:04,486 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:04] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:57:19,786 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:19] "GET / HTTP/1.1" 200 -
2024-12-27 14:57:19,812 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:19] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:57:19,815 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:19] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:57:19,815 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:19] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:57:19,843 - conversation_utils - INFO - Listing conversations
2024-12-27 14:57:19,843 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:57:19,843 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:57:19,844 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:19] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:57:21,744 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,745 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:21,746 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,747 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:21,748 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:57:21,748 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:57:21,748 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:57:21,748 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:57:21,748 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:57:21,748 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:57:21,748 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:21,749 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:21,749 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:57:21,749 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:57:21,749 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:21,749 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:57:21,750 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:57:21,753 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:57:21,753 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:21] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:57:27,319 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:27] "GET / HTTP/1.1" 200 -
2024-12-27 14:57:27,337 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:27] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:57:27,339 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:27] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:57:27,340 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:27] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:57:27,349 - conversation_utils - INFO - Listing conversations
2024-12-27 14:57:27,350 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:57:27,350 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:57:27,351 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:27] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:57:29,182 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:29,183 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:57:29,184 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:57:29,185 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:57:29,186 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:57:29,186 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:57:29,186 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:57:29,186 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:57:29,186 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:29,186 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:29,186 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:57:29,186 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:57:29,187 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:57:29,187 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:57:29,187 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:57:29,190 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:57:29,190 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:57:29] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 14:58:12,393 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:58:12] "GET / HTTP/1.1" 200 -
2024-12-27 14:58:12,417 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:58:12] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 14:58:12,419 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:58:12] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 14:58:12,419 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:58:12] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 14:58:12,430 - conversation_utils - INFO - Listing conversations
2024-12-27 14:58:12,430 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 14:58:12,430 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:58:12,431 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:58:12] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 14:58:13,342 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 14:58:13,342 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:58:13,342 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:58:13,343 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 14:58:13,344 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 14:58:13,345 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:58:13,345 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 14:58:13,346 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 14:58:13,346 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 14:58:13,346 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:58:13,346 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:58:13,346 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 14:58:13,347 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 14:58:13,347 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 14:58:13,347 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 14:58:13,348 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 14:58:13,350 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 14:58:13,350 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 14:58:13] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:00:24,596 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:24] "GET / HTTP/1.1" 200 -
2024-12-27 15:00:24,621 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:24] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:00:24,622 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:24] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:00:24,622 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:24] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:00:24,634 - conversation_utils - INFO - Listing conversations
2024-12-27 15:00:24,635 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:00:24,635 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:00:24,636 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:24] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:00:27,015 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:00:27,015 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:00:27,015 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:00:27,015 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,015 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,015 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,015 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:27,016 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:00:27,017 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:27,017 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:27,017 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:00:27,018 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:00:27,018 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:00:27,018 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,018 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:00:27,018 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,019 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:27,020 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:00:27,020 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:00:27,020 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:00:27,020 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:00:27,022 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:00:27,022 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:00:27,022 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:00:27,022 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:00:27,022 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:00:27,022 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:00:27,022 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:00:27,023 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:00:27,023 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:00:27,023 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:00:27,024 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:27] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:00:48,433 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:48] "GET / HTTP/1.1" 200 -
2024-12-27 15:00:48,455 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:48] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:00:48,455 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:48] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:00:48,456 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:48] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:00:48,474 - conversation_utils - INFO - Listing conversations
2024-12-27 15:00:48,474 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:00:48,474 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:00:48,474 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:48] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:00:50,312 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:00:50,312 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:00:50,312 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:00:50,312 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,312 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,312 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,312 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:50,313 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:00:50,314 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:00:50,315 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:00:50,315 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:00:50,316 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:00:50,316 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:00:50,316 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:00:50,316 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:00:50,316 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:00:50,316 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:00:50,316 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:00:50,316 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:00:50,317 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:00:50,320 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:00:50,320 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:00:50] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:01:40,867 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:01:40] "GET / HTTP/1.1" 200 -
2024-12-27 15:01:40,888 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:01:40] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:01:40,889 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:01:40] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:01:40,889 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:01:40] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:01:40,899 - conversation_utils - INFO - Listing conversations
2024-12-27 15:01:40,899 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:01:40,899 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:01:40,900 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:01:40] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:01:41,920 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:01:41,920 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:01:41,921 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:01:41,921 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:01:41,921 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:01:41,922 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:01:41,922 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:01:41,922 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:01:41,922 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:01:41,922 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:01:41,922 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:01:41,922 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:01:41,922 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:01:41,923 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:01:41,923 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:01:41] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:02:56,509 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:02:56] "GET / HTTP/1.1" 200 -
2024-12-27 15:02:56,533 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:02:56] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:02:56,534 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:02:56] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:02:56,535 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:02:56] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:02:56,552 - conversation_utils - INFO - Listing conversations
2024-12-27 15:02:56,553 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:02:56,553 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:02:56,554 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:02:56] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:02:58,044 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:02:58,044 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:02:58,044 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:02:58,045 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,046 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,047 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,048 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:02:58,048 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:02:58,048 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:02:58,048 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:02:58,048 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:02:58,048 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:02:58,048 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:02:58,049 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:02:58,049 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:02:58,050 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:02:58,050 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:02:58,050 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:02:58,051 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:02:58,051 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:02:58,052 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:02:58,053 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:02:58] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:03:29,233 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:03:29] "GET / HTTP/1.1" 200 -
2024-12-27 15:03:29,256 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:03:29] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:03:29,257 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:03:29] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:03:29,258 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:03:29] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:03:29,268 - conversation_utils - INFO - Listing conversations
2024-12-27 15:03:29,268 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:03:29,269 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:03:29,269 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:03:29] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:03:32,647 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:03:32,648 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:03:32,648 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:03:32,648 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,648 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,648 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,648 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:03:32,649 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:03:32,650 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:03:32,651 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:03:32,651 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:03:32,652 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:03:32,652 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:03:32,652 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:03:32,652 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:03:32,652 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:03:32,652 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:03:32,652 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:03:32,652 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:03:32,652 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:03:32,655 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:03:32,656 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:03:32] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:07:12,110 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:12] "GET / HTTP/1.1" 200 -
2024-12-27 15:07:12,134 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:12] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:07:12,136 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:12] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:07:12,137 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:12] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:07:12,147 - conversation_utils - INFO - Listing conversations
2024-12-27 15:07:12,148 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:07:12,148 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:07:12,149 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:12] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:07:13,088 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:07:13,088 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:07:13,088 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:07:13,088 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,088 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,088 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,088 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,088 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:07:13,089 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,090 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:07:13,091 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:07:13,092 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:07:13,092 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:07:13,092 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:07:13,092 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:07:13,092 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:07:13,093 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:07:13,093 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:07:13,093 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:07:13,094 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:07:13,095 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:07:13,096 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:07:13,096 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:13] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:07:38,877 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:38] "GET / HTTP/1.1" 200 -
2024-12-27 15:07:38,900 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:38] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:07:38,902 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:38] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:07:38,903 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:38] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:07:39,130 - conversation_utils - INFO - Listing conversations
2024-12-27 15:07:39,131 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:07:39,131 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:07:39,132 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:07:39] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:08:58,426 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:08:58] "GET / HTTP/1.1" 200 -
2024-12-27 15:08:58,451 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:08:58] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:08:58,453 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:08:58] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:08:58,453 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:08:58] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:08:58,464 - conversation_utils - INFO - Listing conversations
2024-12-27 15:08:58,464 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:08:58,464 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:08:58,465 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:08:58] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:08:59,244 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,245 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:08:59,246 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:08:59,247 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:08:59,248 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:08:59,249 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:08:59,249 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:08:59,249 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:08:59,249 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:08:59,249 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:08:59,250 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:08:59,250 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:08:59,250 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:08:59,251 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:08:59,252 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:08:59,252 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:08:59,253 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:08:59,253 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:08:59] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:09:32,680 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:09:32] "GET / HTTP/1.1" 200 -
2024-12-27 15:09:32,703 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:09:32] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:09:32,703 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:09:32] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:09:32,705 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:09:32] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:09:32,715 - conversation_utils - INFO - Listing conversations
2024-12-27 15:09:32,715 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:09:32,715 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:09:32,716 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:09:32] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:09:34,403 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:09:34,404 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:09:34,405 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:09:34,405 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:09:34,405 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:09:34,405 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:09:34,405 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:09:34,406 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:09:34,407 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:09:34,407 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:09:34,408 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:09:34,408 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:09:34,408 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:09:34,408 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:09:34,408 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:09:34,408 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:09:34,408 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:09:34,408 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:09:34,409 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:09:34,411 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:09:34,412 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:09:34] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:11:31,072 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:11:31] "GET / HTTP/1.1" 200 -
2024-12-27 15:11:31,096 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:11:31] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:11:31,096 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:11:31] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:11:31,097 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:11:31] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:11:31,107 - conversation_utils - INFO - Listing conversations
2024-12-27 15:11:31,108 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:11:31,108 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:11:31,109 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:11:31] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:11:32,845 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:11:32,846 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:11:32,846 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:11:32,846 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:11:32,847 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:11:32,848 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:11:32,848 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:11:32,848 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:11:32,848 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:11:32,848 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:11:32,850 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:11:32,850 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:11:32,851 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:11:32,851 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:11:32,851 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,852 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:11:32,853 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:11:32,853 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:11:32,853 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:11:32,853 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:11:32,853 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:11:32,853 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:11:32,853 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:11:32,853 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:11:32,854 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:11:32,854 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:11:32] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:12:00,957 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:00] "GET / HTTP/1.1" 200 -
2024-12-27 15:12:00,980 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:00] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:12:00,980 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:00] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:12:00,980 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:00] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:12:00,991 - conversation_utils - INFO - Listing conversations
2024-12-27 15:12:00,991 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:12:00,992 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:12:00,992 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:00] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:12:02,845 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:12:02,846 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:12:02,846 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:12:02,846 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,846 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,846 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,846 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:02,847 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:02,848 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:12:02,848 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:02,848 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:02,848 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,849 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:12:02,850 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:12:02,850 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:12:02,851 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:12:02,851 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:12:02,851 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:12:02,852 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:12:02,852 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:12:02,853 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:12:02,853 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:12:02,853 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:12:02,853 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:12:02,854 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:12:02,855 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:02] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:12:58,405 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:58] "GET / HTTP/1.1" 200 -
2024-12-27 15:12:58,422 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:58] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:12:58,423 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:58] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:12:58,425 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:58] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:12:58,435 - conversation_utils - INFO - Listing conversations
2024-12-27 15:12:58,435 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:12:58,435 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:12:58,436 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:58] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:12:59,786 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:12:59,786 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:12:59,786 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:12:59,786 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,786 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,786 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,786 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:59,787 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,788 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,789 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:12:59,789 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:12:59,789 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:12:59,789 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:12:59,789 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:12:59,790 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:12:59,790 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:12:59,790 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:12:59,790 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:12:59,790 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:12:59,790 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:12:59,790 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:12:59,790 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:12:59,791 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:12:59,793 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:12:59,794 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:12:59] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 15:13:34,254 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:13:34] "GET / HTTP/1.1" 200 -
2024-12-27 15:13:34,275 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:13:34] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 15:13:34,276 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:13:34] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 15:13:34,277 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:13:34] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 15:13:34,287 - conversation_utils - INFO - Listing conversations
2024-12-27 15:13:34,288 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 15:13:34,288 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:13:34,289 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:13:34] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 15:13:35,125 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:13:35,125 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,126 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:13:35,127 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 15:13:35,127 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 15:13:35,127 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:13:35,127 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 15:13:35,127 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 15:13:35,127 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 15:13:35,127 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 15:13:35,127 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 15:13:35,128 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 15:13:35,128 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 15:13:35] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 16:41:59,950 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:41:59] "GET / HTTP/1.1" 200 -
2024-12-27 16:41:59,974 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:41:59] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 16:41:59,975 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:41:59] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 16:41:59,976 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:41:59] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 16:42:00,014 - conversation_utils - INFO - Listing conversations
2024-12-27 16:42:00,015 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 16:42:00,015 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 16:42:00,016 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:00] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 16:42:01,705 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:01,706 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 16:42:01,707 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 16:42:01,708 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 16:42:01,708 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 16:42:01,709 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

2024-12-27 16:42:01,709 - format_utils - ERROR - Problem message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 16:42:01,709 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 16:42:01,709 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 16:42:01,709 - format_utils - ERROR - Error formatting message at index 14: 'text'
2024-12-27 16:42:01,709 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 248, in produce_conversation_objects_for_client
    objects_for_client.extend(_format_user_message(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 22, in _format_user_message
    user_block = user_message['content'][0]['text']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'text'

2024-12-27 16:42:01,709 - format_utils - ERROR - Problem message: {'role': 'user', 'content': [{'type': 'tool_result', 'tool_use_id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'content': '# difficulty roll \n\n56\n\n# World roll\n\n{fate_roll}\n\n'}]}
2024-12-27 16:42:01,710 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Resulting scene\nYou begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance.\n\n# Tracked operations\n* MOVE_PLAYER(south 0.5 miles) => now in south quadrant, near orchard edge\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Exhausted, weakened further from exertion                                                 |\n| Psychological condition     | Anxious about nearby movement                                                             |\n| Skin Temperature           | Hot and sweating from exertion                                                            |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Very thirsty, worse from exertion                                                         |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Very low                                                                                  |\n| Sleepiness                  | Awake but tired from exertion                                                            |\n| Clarity of sight            | Clear - morning light                                                                     |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:25 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 46°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | South quadrant                                                                           |\n| Approx. position in quadrant| Northern edge near orchard                                                               |"}]}
2024-12-27 16:42:01,710 - __main__ - DEBUG - conversation_objects: [{'source': 'client', 'type': 'user_message', 'user_message': 'Go'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': 'Game successfully loaded. Proceed to generate the map?'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': "\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Yes'}, {'source': 'llm', 'type': 'map_data', 'map_data': '\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start'}, {'source': 'client', 'type': 'user_message', 'user_message': 'Start game'}, {'source': 'llm', 'type': 'ooc_message', 'ooc_message': "The game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}, {'source': 'client', 'type': 'user_message', 'user_message': 'Run 1 mile south'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': 'Error formatting message at index 13: list index out of range'}, {'source': 'server', 'type': 'error', 'error_type': 'parsing_message_error', 'error_message': "Error formatting message at index 14: 'text'"}, {'source': 'server', 'type': 'resulting_scene_description', 'resulting_scene_description': "You begin running south from the trading post, your legs shaky at first but gradually finding their rhythm. The cool morning air burns in your lungs as you move. After about a quarter mile, you're already feeling the strain of your weakened condition, but you press on.\n\nAbout halfway to your destination, your legs begin to feel like lead, and you're forced to slow to a walk, breathing heavily. The morning sun now fully risen, illuminates the meadowland and apple orchard ahead of you. You can see the two-story farmhouse in the distance.\n\nAs you catch your breath, you notice movement in the tall grass about 100 yards to your east - something or someone is moving parallel to your path, but keeping their distance."}]
2024-12-27 16:42:01,713 - __main__ - DEBUG - JSONified result: <Response 13918 bytes [200 OK]>
2024-12-27 16:42:01,713 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:01] "POST /set_current_conversation HTTP/1.1" 200 -
2024-12-27 16:42:39,542 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:39] "GET / HTTP/1.1" 200 -
2024-12-27 16:42:39,566 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:39] "GET /static/css/main_chat.css HTTP/1.1" 200 -
2024-12-27 16:42:39,567 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:39] "[36mGET /static/js/client.js HTTP/1.1[0m" 304 -
2024-12-27 16:42:39,567 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:39] "[36mGET /static/css/left_sidebar.css HTTP/1.1[0m" 304 -
2024-12-27 16:42:39,577 - conversation_utils - INFO - Listing conversations
2024-12-27 16:42:39,577 - conversation_utils - INFO - Loading conversation 20241227125625
2024-12-27 16:42:39,577 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 16:42:39,578 - werkzeug - INFO - 127.0.0.1 - - [27/Dec/2024 16:42:39] "GET /list_conversations HTTP/1.1" 200 -
2024-12-27 16:42:40,545 - conversation_utils - INFO - Loading conversation 20241227134026
2024-12-27 16:42:40,546 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 16:42:40,546 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Go'}]}
2024-12-27 16:42:40,546 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,546 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,546 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,546 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,547 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,547 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,547 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# OOC Message\nGame successfully loaded. Proceed to generate the map?'}]}
2024-12-27 16:42:40,547 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:40,547 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:40,547 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Map Data Block\n# Map Description\n\nThe game takes place in a remote region of the Pacific Northwest, specifically a 9x9 kilometer area of varied terrain encompassing both wilderness and scattered human settlements. The setting features:\n\n* Dense evergreen forests covering much of the region, primarily consisting of Douglas fir, western red cedar, and Sitka spruce\n* A network of streams and rivers flowing from the mountainous northeastern region\n* A small mountain range in the northeastern portion of the map, with peaks reaching around 3,000 feet\n* A valley system running through the central and southern portions\n* A small town (population ~2,000 pre-apocalypse) in the southeastern region\n* Scattered farmland and rural properties throughout the valley areas\n* An abandoned military research facility hidden in the mountains to the north (location of the zombie heart)\n* A self-sustaining eco-community in a fortified position in the southwestern region (the utopian community)\n* Various hiking trails, logging roads, and rural routes connecting different areas\n* Several small lakes and reservoirs\n* Numerous caves and rock formations, particularly in the mountainous areas\n\nThe climate is typical of the Pacific Northwest - mild but wet winters, and warm summers. The region experiences frequent rainfall, particularly in the winter months, and occasional snow at higher elevations.\n\nThe zombie heart's presence in the military facility has led to a higher concentration of infected and mutated creatures in the northern regions, while the southern areas, particularly around the eco-community, are relatively safer but still dangerous.\n\n# OOC Message\nMap generated. Proceed to generate the zones?"}]}
2024-12-27 16:42:40,548 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:40,548 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:40,548 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Zones\n\n**Central Zone**\n* Overview: A mixed terrain area featuring both forest and meadowland, with scattered homesteads and a small trading post that was abandoned early in the outbreak.\n* Risk/reward level: 3/10 - Relatively safe area with moderate zombie presence and few special infected. Most buildings have been picked clean, but basic supplies can still be found.\n* Types of resources: Basic survival supplies, firewood, some farming equipment, basic tools, occasional canned food.\n* Types of resources not contained: Advanced medical supplies, weapons, fuel.\n\n**North Zone**\n* Overview: The beginning of the mountainous region, featuring steep terrain, dense forest, and the first signs of military presence.\n* Risk/reward level: 7/10 - Dangerous terrain combined with increased zombie activity and occasional military-mutated specimens.\n* Types of resources: Military gear, advanced medical supplies, high-quality camping equipment.\n* Types of resources not contained: Food, civilian supplies, farming equipment.\n\n**Northeast Zone**\n* Overview: Mountainous terrain containing the hidden military research facility and the zombie heart.\n* Risk/reward level: 10/10 - Extremely dangerous due to high concentration of special infected and military automated defense systems.\n* Types of resources: Advanced military equipment, experimental technology, high-grade medical supplies.\n* Types of resources not contained: Basic survival supplies, food, water.\n\n**East Zone**\n* Overview: Rolling hills transitioning from mountains to valley, featuring a mix of forest and former farmland.\n* Risk/reward level: 5/10 - Moderate risk area with standard zombie presence and occasional special infected.\n* Types of resources: Farming equipment, agricultural supplies, basic medical supplies.\n* Types of resources not contained: Advanced technology, military equipment.\n\n**Southeast Zone**\n* Overview: Location of the small town, featuring various businesses, residential areas, and municipal buildings.\n* Risk/reward level: 8/10 - High risk due to concentrated zombie population in urban area.\n* Types of resources: Wide variety of civilian supplies, medical supplies, food, ammunition.\n* Types of resources not contained: Military equipment, advanced technology.\n\n**South Zone**\n* Overview: Valley region with scattered farms and rural properties.\n* Risk/reward level: 4/10 - Moderate risk with standard zombie presence.\n* Types of resources: Agricultural supplies, food, basic tools, fuel.\n* Types of resources not contained: Advanced medical supplies, military equipment.\n\n**Southwest Zone**\n* Overview: Location of the fortified eco-community, surrounded by defensive structures and sustainable agriculture.\n* Risk/reward level: 9/10 - Extremely difficult to approach due to community defenses, but potentially great rewards.\n* Types of resources: Advanced sustainable technology, medical supplies, food, clean water.\n* Types of resources not contained: Military equipment, conventional weapons.\n\n**West Zone**\n* Overview: Mixed forest and meadowland with several small lakes and streams.\n* Risk/reward level: 2/10 - Relatively safe area with low zombie presence.\n* Types of resources: Fresh water, fish, basic survival supplies, firewood.\n* Types of resources not contained: Advanced technology, weapons, medical supplies.\n\n**Northwest Zone**\n* Overview: Dense forest with numerous streams and some rocky outcroppings.\n* Risk/reward level: 6/10 - Moderate to high risk due to special infected moving down from military facility.\n* Types of resources: Advanced camping gear, survival equipment, clean water sources.\n* Types of resources not contained: Urban supplies, medical equipment.\n\n# OOC Message\nZones generated. Generate quadrants for the central zone?'}]}
2024-12-27 16:42:40,548 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:40,548 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Yes'}]}
2024-12-27 16:42:40,548 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': '# Map Data Block\n# Quadrants of Central Zone\n\n**Central Quadrant**\n* Overview: A small clearing containing an abandoned trading post - a converted gas station that served as a community hub in the early days of the outbreak before being abandoned.\n* Notable features:\n    * The trading post building itself - a sturdy structure with boarded windows\n    * A small parking lot with a few abandoned vehicles\n    * A water collection system on the roof, no longer maintained but still functional\n    * A small vegetable garden, now overgrown but with some edible plants\n* Risk/reward level: 3/10 - The clearing offers good visibility but also leaves one exposed. Building has been largely looted but might contain overlooked items.\n* Types of resources: Basic tools, some canned food, rainwater collection possibility, vehicle parts.\n* Types of resources not contained: Weapons, medical supplies, fuel.\n\n**North Quadrant**\n* Overview: Dense forest area with a small stream running through it, featuring a hiking trail that once connected to the northern zones.\n* Notable features:\n    * A clear flowing stream with potential for fishing\n    * Several game trails crossing the hiking path\n    * A small wooden bridge crossing the stream\n    * An old trail marker board with a faded map\n* Risk/reward level: 2/10 - Good visibility along the trail, multiple escape routes through the woods.\n* Types of resources: Fresh water, possibility of fish, edible plants, firewood.\n* Types of resources not contained: Man-made supplies, shelter options.\n\n**Northeast Quadrant**\n* Overview: A cluster of three small homesteads connected by dirt roads, all abandoned but in varying states of decay.\n* Notable features:\n    * Three separate houses with different layouts and conditions\n    * A shared well system between properties\n    * Several outbuildings and sheds\n    * Small family cemetery\n* Risk/reward level: 4/10 - Multiple buildings to check but also multiple places for zombies to hide.\n* Types of resources: Household items, farming tools, well water, possible preserved food.\n* Types of resources not contained: Modern technology, weapons.\n\n**East Quadrant**\n* Overview: Open meadowland with scattered trees and a small pond, formerly used for grazing livestock.\n* Notable features:\n    * A pond with reasonably clean water\n    * Old wooden fence lines\n    * A collapsed barn\n    * Several large rocks suitable for temporary shelter\n* Risk/reward level: 3/10 - Very exposed area but with good visibility in all directions.\n* Types of resources: Water source, some natural edibles, basic building materials.\n* Types of resources not contained: Modern supplies, food stores.\n\n**Southeast Quadrant**\n* Overview: An area where the forest meets meadowland, featuring an old logging road and several fallen trees.\n* Notable features:\n    * Logging road providing easier travel\n    * Natural barriers created by fallen trees\n    * Small cleared areas from past logging\n    * An abandoned logging equipment storage shed\n* Risk/reward level: 3/10 - Good mix of cover and visibility, with multiple escape routes.\n* Types of resources: Tools, firewood, potential shelter materials.\n* Types of resources not contained: Food, water, medical supplies.\n\n**South Quadrant**\n* Overview: A relatively open area with a small apple orchard and an abandoned farmhouse.\n* Notable features:\n    * Apple trees (fruit in season)\n    * Two-story farmhouse with a basement\n    * Root cellar separate from house\n    * Old pickup truck in the driveway\n* Risk/reward level: 4/10 - Building provides both shelter and risk, orchard provides some cover.\n* Types of resources: Fruit (seasonal), preserved foods possible, basic tools, shelter.\n* Types of resources not contained: Medical supplies, weapons.\n\n**Southwest Quadrant**\n* Overview: Mixed forest and brush area with a small seasonal creek and rocky outcroppings.\n* Notable features:\n    * Several large rock formations providing natural shelter\n    * Seasonal creek bed (currently dry)\n    * Dense brush providing good cover\n    * Small cave in the largest rock formation\n* Risk/reward level: 2/10 - Excellent natural cover and hiding spots.\n* Types of resources: Natural shelter, firewood, some edible plants.\n* Types of resources not contained: Man-made supplies.\n\n**West Quadrant**\n* Overview: Thick forest with a small clearing containing the ruins of an old ranger station.\n* Notable features:\n    * Partially collapsed ranger station\n    * Old fire pit with grill grate\n    * Several picnic tables\n    * Remnants of an information board\n* Risk/reward level: 3/10 - Building provides both opportunity and risk.\n* Types of resources: Basic camping supplies, maps, basic tools.\n* Types of resources not contained: Food, medical supplies.\n\n**Northwest Quadrant**\n* Overview: A combination of forest and rocky terrain with several small caves and overhangs.\n* Notable features:\n    * Multiple small caves and overhangs\n    * Natural spring\n    * Dense forest cover\n    * Old deer hunting blind in a tree\n* Risk/reward level: 3/10 - Good natural shelter options but caves could harbor threats.\n* Types of resources: Fresh water from spring, natural shelter, firewood.\n* Types of resources not contained: Man-made supplies, food stores.\n\n# OOC Message\nMap, zones, and quadrants generated. Begin the campaign?'}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start'}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nYou awaken at dawn in the central quadrant of the map, specifically in the abandoned trading post. You've been here for two days, recovering from a fever that thankfully broke last night. Through the boarded windows, you can see the sun beginning to rise, casting long shadows across the parking lot outside.\n\n# Condition table\n\n| **Condition**                | **Description**                                                                           |\n|-----------------------------|------------------------------------------------------------------------------------------|\n| Physical condition          | Weakened from recent fever but recovering                                                 |\n| Psychological condition     | Alert but anxious                                                                         |\n| Skin Temperature           | Slightly cool                                                                             |\n| Hunger                      | Very hungry                                                                               |\n| Thirst                      | Thirsty                                                                                   |\n| Encumbrance                 | Light (carrying only basic clothing)                                                      |\n| Energy Levels               | Low due to recent illness                                                                 |\n| Sleepiness                  | Awake and alert                                                                          |\n| Clarity of sight            | Clear - early morning light                                                              |\n| Key experience gained       | Basic survival knowledge                                                                  |\n| Date                        | October 1, 2026                                                                           |\n| Time                        | 6:15 am                                                                                   |\n| Weather                     | Clear, cool autumn morning                                                                |\n| Environmental Temperature   | 45°F                                                                                      |\n| Current zone               | Central zone                                                                              |\n| Current quadrant in zone    | Central quadrant                                                                         |\n| Approx. position in quadrant| Inside trading post building                                                             |\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Start game'}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Checking if message is user: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Checking if message is analysis: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,549 - format_utils - DEBUG - Checking if message is rolls: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Checking if message is result: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Checking if message is map data: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Checking if message is OOC: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Formatting OOC message: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# OOC Message\nThe game has already started! You're in the trading post building at dawn, recovering from a fever. You're hungry, thirsty, and a bit weak, but the fever has broken. The morning sun is coming through the boarded windows.\n\nYou can take any action you'd like - for example:\n* Look around the trading post\n* Check what supplies you might have\n* Look outside through the windows\n* Try to find food or water\n* Rest more to recover strength\n* Or anything else you'd like to attempt\n\nWhat would you like to do?"}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Checking if message is user: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Formatting user message: {'role': 'user', 'content': [{'type': 'text', 'text': 'Run 1 mile south'}]}
2024-12-27 16:42:40,550 - format_utils - DEBUG - Formatting mixed content: {'role': 'assistant', 'content': [{'type': 'text', 'text': "# Difficulty analysis\nRunning a mile in your current condition would be quite challenging due to several factors:\n* You're weakened from a recent fever\n* You're very hungry and thirsty\n* Your energy levels are low\n* However, you do have the advantage of a clear morning with good visibility\n* The terrain heading south includes both open areas and some cover, with relatively flat ground\n\nGiven your weakened condition, there's a 70% chance you'll need to stop or significantly slow down before reaching your destination.\n\n# Difficulty target\n70\n\n# World reveal analysis\nMoving through potentially unexplored territory for a mile could reveal new elements or encounters.\n\n# World reveal level\nModerate"}, {'type': 'tool_use', 'id': 'toolu_01B3sBGr4R9Fty5coi2irheA', 'name': 'roll_skill_and_world_reveal', 'input': {}}]}
2024-12-27 16:42:40,551 - format_utils - ERROR - Error formatting message at index 13: list index out of range
2024-12-27 16:42:40,551 - format_utils - ERROR - Full traceback:
Traceback (most recent call last):
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 245, in produce_conversation_objects_for_client
    objects_for_client.extend(_process_mixed_content(message))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 222, in _process_mixed_content
    objects.extend(_format_analysis({'content': [{'text': reconstructed}]}))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mlinnem/Dev/TheUndyingWorld/TheUndyingWorld/format_utils.py", line 42, in _format_analysis
    analysis_value_string = analysis_sections[i + 1].split('\n')[1].strip()
                            ~~~~~~~~~~~~~~~~~^^^^^^^
IndexError: list index out of range

